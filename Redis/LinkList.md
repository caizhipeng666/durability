# 链表

index|question
---|---
1|[链表的用途](#用途)
2|[链表的实现](#实现)
3|[发布订阅用到了链表?](#发布订阅)

### 用途
类别|用途
---|---
缓存值|链表缓存值<br>当列表存在: `较多元素` & `较长字符串`
Redis其他功能|发布订阅、慢查询、监视器

### 实现
```
1. 前后指针
2. 长度计数器
3. 链表多态: dup、free、match
```

### 发布订阅
方式|优|缺
---|---|---
SUBSCRIBE + PUBLISH|多端订阅、简单、性能高|数据会丢失
BLPOP + LPUSH|简单、性能高|不支持多端(可优化)

##### subscribe + publish
```
发送者(pub)发送消息，订阅者(sub)接收消息

"""publish"""
首先, 在结构体redisServer中的pubsub_channels中, 找出键为该频道的结点,
遍历该结点的值, 找出所有的客户端, 将消息发送给这些客户端

然后, 遍历结构体Redis Client中的pubsub_patterns, 找出包含该频道的模式的结点, 
将消息发送给订阅了该模式的客户端

"""subscribe"""
在客户端结构体client中, 有一个属性为pubsub_channels, 
该属性表明了该客户端订阅的所有频道, 它是一个字典类型, 通过哈希表实现, 
其中的每个元素都包含了一个键值对以及指向下一个元素的指针, 
每次订阅都要向其中插入一个结点, 键表示订阅的频道, 值为空

在表示服务器端的结构体redisServer中, 也有一个属性为pubsub_channels, 
但此处它表示的是该服务器端中的所有频道以及订阅了这个频道的客户端, 
它也是一个字典类型, 插入结点时, 键表示频道, 
值则是订阅了这个频道的所有客户端组成的链表


最后Redis通知客户端其订阅成功
```
